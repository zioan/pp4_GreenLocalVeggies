{% extends "base.html" %}
{% load static %}
{% load shop_extras %}
{% load cart_tags %}

{% block title %}Green Local Veggies - {{ product.name }}{% endblock title %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Product Image -->
        <div class="col-md-6 mb-4">
            <img src="{{ product.image.url }}" 
                 class="img-fluid rounded product-details-image" 
                 alt="{{ product.name }}"
                 onerror="this.onerror=null;this.src='{% static 'images/placeholder-image.jpg' %}';">
        </div>
        <!-- Product Details -->
        <div class="col-md-6">
            <h1 class="mb-3">{{ product.name }}</h1>
            <p class="text-muted mb-3">Category: {{ product.category }}</p>
            <h4 class="text-success mb-3">€ {{ product.price }}</h4>
            <p class="lead mb-3">{{ product.description }}</p>
            <p class="mb-3">
                <span class="fw-bold">Availability:</span> 
                {% if product.stock > 0 %}
                    <span class="text-success">In Stock</span>
                {% else %}
                    <span class="text-danger">Out of Stock</span>
                {% endif %}
            </p>
            <p class="mb-3">Available Quantity: {{ product.stock }} {{ product.unit }}</p>
            {% get_cart_quantity product.id as cart_quantity %}
            {% if cart_quantity %}
            <p>Current quantity in cart: {{ cart_quantity }} {{ product.unit }}</p>
            {% endif %}
            
            <form method="post" action="{% url 'add_to_cart' product.id %}" class="add-to-cart-form">
                {% csrf_token %}
                <div class="d-flex align-items-center mb-3">
                    <label for="quantity" class="me-2">Quantity ({{ product.unit }}):</label>
                    <div class="quantity-container">
                        <button type="button" class="quantity-btn quantity-decrease" data-product-id="{{ product.id }}">-</button>
                        <input type="number" 
                               id="quantity" 
                               name="quantity" 
                               class="form-control quantity-input" 
                               min="1" 
                               max="{{ product.stock }}" 
                               value="1" 
                               data-product-id="{{ product.id }}" 
                               readonly>
                        <button type="button" class="quantity-btn quantity-increase" data-product-id="{{ product.id }}">+</button>
                    </div>
                </div>
                <h4 id="product-price" class="text-success mb-3" data-base-price="{{ product.price }}">
                    Total € <span id="total-price">{{ product.price }}</span>
                </h4>
                {% include "shop/components/form-btn.html" %}
            </form>
        </div>
    </div>
    
    <!-- Related Products -->
    <div class="mt-5">
        <h3>Related Products</h3>
        <div class="row">
            {% for related_product in related_products %}
                <div class="col-md-3 mb-4">
                    {% include "shop/components/product-card.html" with product=related_product %}
                </div>
            {% endfor %}
        </div>
    </div>

    <a href="{% url 'index' %}" class="btn btn-secondary mt-4">Back to Products</a>
</div>
<script src="{% static 'shop/javascript/product-details.js' %}"></script>
{% endblock content %}